const publicVapidKey="BJu_4-wfWdkSMwLrLzSbllzNHnuWFdYnGmZbNk7damnfOReovgffVPyzEk6yJBNRg6Qz2gpR5nZf-uka462Zh4M";if("serviceWorker" in navigator){console.log("entrou auqi???")
send().catch(err=>console.log(err))}
async function send(){console.log("Registering service worker...");const register=await navigator.serviceWorker.register("/sw.js",{scope:"/"});console.log("Service Worker Registered...");console.log("Registering Push...");const subscription=await register.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:urlBase64ToUint8Array(publicVapidKey)});console.log("Push Registered...");let user=window.localStorage.getItem("login")==null?null:JSON.parse(window.localStorage.getItem("login")).email;console.log("Sending Push...");let fetchs=await fetch("./api/v1/notifications",{method:"POST",body:JSON.stringify(subscription),headers:{"content-type":"application/json","User":user}});console.log('fetchs => ',await fetchs.json())
console.log("Push Sent...")}
function urlBase64ToUint8Array(base64String){const padding="=".repeat((4-base64String.length%4)%4);const base64=(base64String+padding).replace(/\-/g,"+").replace(/_/g,"/");const rawData=window.atob(base64);const outputArray=new Uint8Array(rawData.length);for(let i=0;i<rawData.length;++i){outputArray[i]=rawData.charCodeAt(i)}
return outputArray}